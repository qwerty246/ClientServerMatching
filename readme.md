Данный проект является результатом выполнения тестового задания, согласно которому нужно было написать простую биржу с клиент-серверной архитектурой.

Проект поделен на 5 подпроектов:
1) Client - клиентское приложение (к сожалению, успел сделать только вариант консольного приложения);
2) libClientlib.so - динамическая библиотека для клиента (здесь представлен основной клиентский функционал. Изначально предполагалось, что библиотека будет использоваться и в консольном, и в Gui приложениях);
3) Server - серверное приложение;
4) libServerlib.so - динамическая библиотека для сервера (здесь представлен основной серверный функционал. Я решил выделить основной функционал в библиотеку, чтобы можно было тестировать сервер в оффлайн режиме);
5) Tests - тесты.



# Иерархия классов

Client
Основной класс для клиента. Регистрирует пользователя, предоставляет ему основной функционал для работы с биржей. Отправляет запросы и принимает ответы от сервера в формате json и выводит информацию на экран в соответствии с полученным ответом.

Core
Представлен в программе в единственном экземпляре. Хранит всю информацию и пользователях.

RequestHandler
Предоставляет методы для работы с сервером. Здесь происходит создание и смерживание заявок, предоставление различной информации о пользователях.

Server
Стартует работу сервера.

Session
Принимает запросы от пользователей и выдает результаты при помощи RequestHandler.

Balance
Баланс пользователя и различные операции с ним.

Offer
Содержит количество валюты, цену, id пользователя.

User
Содержит BalanceUSD, BalanceRUB, активные и завершенные предложения пользователя.




# Сборка

Проект собирается с помощью cmake, особых параметров не требуется. Пример сборки:

*cd ClientServerMatching*
*mkdir build*
*cd build*
*cmake ..*
*cmake --build .*

Я решил задать путь создания приложений и библиотек по пути ClientServerMatching/bin/



# Запуск

Для запуска сервера достаточно запустить Server.

Для запуска клиента нужно запустить Client. После запуска появится меню с 4 возможными вариантами:
0) Exit - завершает программу;
1) Registration - регистрирует нового пользователя. Требуются незарегистрированное имя и пароль;
2) Autorisation - авторизирует существующего пользователя. Требуются имя и пароль;
3) Remove user - удаляет существующего пользователя. Требуются имя и пароль.
Поскольку я не успел добавить базу данных, то перезапуск сервера удаляет всех пользователей и всю информацию о них.

При успешной регистрации или авторизации пользователя появится новое меню. Здесь команд больше, и я решил их сгруппировать по назначению:
0) Exit - завершает программу;

10) Show my balance - выводит на экран баланс пользователя, здесь и далее доступны только USD и RUB;
11) Show my active offers - выводит на экран информацию о всех незавершенных сделках пользователя (id сделки, количество USD, цена в RUB);
12) Show my completed offers - выводит на экран информацию о всех завершенных и удаленных сделках пользователя (id сделки, количество USD, цена в RUB, тип сделки);
13) Show all sale offers - выводит на экран информацию о всех незавершенных продажах других пользователей (имя продавца, количество USD, цена в RUB). В добавок выводится простая статистика: самая высокая цена, самая низкая цена и средняя цена среди всех предложений о продаже;
14) Show all purchase offers - аналогично для покупок других пользователей;

20) Replenish balance, USD - пополняет баланс пользователя на сумму USD, которую он сам укажет (не особо полезно, т. к. в задании снято ограничение положительного баланса пользователя);
21) Replenish balance, RUB - аналогично;
22) Remove balance, USD - снимает средства с баланса пользователя на сумму USD, которую он сам укажет;
23) Remove balance, RUB - аналогично;

30) Sale USD - создает предложение о продаже USD. Перед добавлением происходит попытка найти самое выгодное предложение. Если такое найдено, то при одинаковом количестве заявленной валюты оба пользователя производят обмен по цене покупателя, и оба предложения сгорают. Если у продавца предложение меньше, его сделка сгорает, а покупатель вычитает соответствующую часть от своего предложения и продолжает стоять на торгах. Если же у покупателя предложение меньше, то его сделка сгорает, а продавец снова пытается найти и смержиться с лучшим предложением;
31) Purchase USD - аналогично, но происходит создание предложения о покупке;
32) Remove offer - удаляет активное предложение пользователя по id (его можно узнать в пункте 11).

Я использовал gtest в качестве основного инструмента тестирования. В целом я проверял сервер на предмет регистрации, авторизации и удаления пользоваетеля, вывод информации о самом пользователе и других пользователях, а также создание и смерживание предложений в различных вариациях. Пример, указанный в задании, реализован в тесте TestOfferMerging.SuccessfullMerging_MakeDialBetweenThreeUsers1.